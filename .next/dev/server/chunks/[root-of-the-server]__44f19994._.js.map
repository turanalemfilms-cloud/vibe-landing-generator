{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nexport function supabaseBrowser() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n  if (!url || !anon) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / NEXT_PUBLIC_SUPABASE_ANON_KEY')\n  return createClient(url, anon)\n}\n\nexport function supabaseServer() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const service = process.env.SUPABASE_SERVICE_ROLE_KEY\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!url) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL')\n\n  // Prefer service role for server-side writes. Fallback to anon for quick demo.\n  const key = service || anon\n  if (!key) throw new Error('Missing SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY')\n\n  return createClient(url, key, {\n    auth: { persistSession: false },\n  })\n}\n\nexport function supabaseService() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const service = process.env.SUPABASE_SERVICE_ROLE_KEY\n  if (!url || !service) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY')\n  return createClient(url, service, { auth: { persistSession: false } })\n}\n\nexport function supabaseServerWithAccessToken(accessToken: string) {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n  if (!url || !anon) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / NEXT_PUBLIC_SUPABASE_ANON_KEY')\n  if (!accessToken) throw new Error('Missing access token')\n\n  // Use anon key + user JWT so RLS applies server-side.\n  return createClient(url, anon, {\n    auth: { persistSession: false },\n    global: {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,SAAS;IACd,MAAM;IACN,MAAM;IACN;;IACA,OAAO,IAAA,gMAAY,EAAC,KAAK;AAC3B;AAEO,SAAS;IACd,MAAM;IACN,MAAM,UAAU,QAAQ,GAAG,CAAC,yBAAyB;IACrD,MAAM;IAEN;;IAEA,+EAA+E;IAC/E,MAAM,MAAM,WAAW;IACvB;;IAEA,OAAO,IAAA,gMAAY,EAAC,KAAK,KAAK;QAC5B,MAAM;YAAE,gBAAgB;QAAM;IAChC;AACF;AAEO,SAAS;IACd,MAAM;IACN,MAAM,UAAU,QAAQ,GAAG,CAAC,yBAAyB;IACrD,IAAI,CAAC,OAAO,CAAC,SAAS,MAAM,IAAI,MAAM;IACtC,OAAO,IAAA,gMAAY,EAAC,KAAK,SAAS;QAAE,MAAM;YAAE,gBAAgB;QAAM;IAAE;AACtE;AAEO,SAAS,8BAA8B,WAAmB;IAC/D,MAAM;IACN,MAAM;IACN;;IACA,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;IAElC,sDAAsD;IACtD,OAAO,IAAA,gMAAY,EAAC,KAAK,MAAM;QAC7B,MAAM;YAAE,gBAAgB;QAAM;QAC9B,QAAQ;YACN,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,aAAa;YACxC;QACF;IACF;AACF"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/app/api/funnel/lead/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { supabaseService } from '@/lib/supabase'\n\nexport const runtime = 'nodejs'\n\nexport async function POST(req: Request) {\n  let body: any = null\n  try {\n    body = await req.json()\n  } catch {\n    body = null\n  }\n\n  const brief = body?.brief ?? {}\n  const styleKey = typeof body?.styleKey === 'string' ? body.styleKey : null\n\n  let supabase: ReturnType<typeof supabaseService>\n  try {\n    supabase = supabaseService()\n  } catch (e: any) {\n    return NextResponse.json(\n      { error: 'Server misconfigured: set SUPABASE_SERVICE_ROLE_KEY', details: String(e?.message || e) },\n      { status: 500 }\n    )\n  }\n  const { data, error } = await supabase\n    .from('leads')\n    .insert({ brief, style_key: styleKey })\n    .select('id')\n    .single()\n\n  if (error) return NextResponse.json({ error: error.message }, { status: 500 })\n  return NextResponse.json({ leadId: data.id })\n}\n\nexport async function PATCH(req: Request) {\n  let body: any = null\n  try {\n    body = await req.json()\n  } catch {\n    body = null\n  }\n\n  const leadId = String(body?.leadId || '')\n  if (!leadId) return NextResponse.json({ error: 'leadId required' }, { status: 400 })\n\n  const patch: any = {}\n  for (const k of ['full_name', 'phone', 'telegram', 'liked', 'payment_status', 'payment_proof_path', 'site_id']) {\n    if (body[k] !== undefined) patch[k] = body[k]\n  }\n\n  let supabase: ReturnType<typeof supabaseService>\n  try {\n    supabase = supabaseService()\n  } catch (e: any) {\n    return NextResponse.json(\n      { error: 'Server misconfigured: set SUPABASE_SERVICE_ROLE_KEY', details: String(e?.message || e) },\n      { status: 500 }\n    )\n  }\n  const { error } = await supabase.from('leads').update(patch).eq('id', leadId)\n  if (error) return NextResponse.json({ error: error.message }, { status: 500 })\n  return NextResponse.json({ ok: true })\n}\n\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACrC,IAAI,OAAY;IAChB,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAM;QACN,OAAO;IACT;IAEA,MAAM,QAAQ,MAAM,SAAS,CAAC;IAC9B,MAAM,WAAW,OAAO,MAAM,aAAa,WAAW,KAAK,QAAQ,GAAG;IAEtE,IAAI;IACJ,IAAI;QACF,WAAW,IAAA,2IAAe;IAC5B,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAuD,SAAS,OAAO,GAAG,WAAW;QAAG,GACjG;YAAE,QAAQ;QAAI;IAElB;IACA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC;QAAE;QAAO,WAAW;IAAS,GACpC,MAAM,CAAC,MACP,MAAM;IAET,IAAI,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,MAAM,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAC5E,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,QAAQ,KAAK,EAAE;IAAC;AAC7C;AAEO,eAAe,MAAM,GAAY;IACtC,IAAI,OAAY;IAChB,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAM;QACN,OAAO;IACT;IAEA,MAAM,SAAS,OAAO,MAAM,UAAU;IACtC,IAAI,CAAC,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAkB,GAAG;QAAE,QAAQ;IAAI;IAElF,MAAM,QAAa,CAAC;IACpB,KAAK,MAAM,KAAK;QAAC;QAAa;QAAS;QAAY;QAAS;QAAkB;QAAsB;KAAU,CAAE;QAC9G,IAAI,IAAI,CAAC,EAAE,KAAK,WAAW,KAAK,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE;IAC/C;IAEA,IAAI;IACJ,IAAI;QACF,WAAW,IAAA,2IAAe;IAC5B,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAuD,SAAS,OAAO,GAAG,WAAW;QAAG,GACjG;YAAE,QAAQ;QAAI;IAElB;IACA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,OAAO,EAAE,CAAC,MAAM;IACtE,IAAI,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,MAAM,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAC5E,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC"}}]
}