{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/lib/siteConfig.ts"],"sourcesContent":["import { z } from 'zod'\n\nexport const StyleKey = z.enum(['minimalist_tech', 'bold_modern', 'clean_corporate'])\nexport type StyleKey = z.infer<typeof StyleKey>\n\nexport const SiteBriefSchema = z.object({\n  businessName: z.string().min(1),\n  targetAudience: z.string().min(1),\n  services: z.array(z.string().min(1)).min(1),\n  uniqueSellingPoints: z.array(z.string().min(1)).min(1),\n  cta: z\n    .object({\n      label: z.string().min(1),\n      href: z.string().min(1),\n    })\n    .default({ label: 'Өтінім қалдыру', href: '#lead' }),\n  language: z.literal('KZ').default('KZ'),\n})\nexport type SiteBrief = z.infer<typeof SiteBriefSchema>\n\nexport const TailwindStyleTokensSchema = z.object({\n  fontHeading: z.string().min(1),\n  fontBody: z.string().min(1),\n  bg: z.string().min(1),\n  card: z.string().min(1),\n  text: z.string().min(1),\n  muted: z.string().min(1),\n  border: z.string().min(1),\n  accent: z.string().min(1),\n  accentText: z.string().min(1),\n  accentRing: z.string().min(1),\n  radiusCard: z.string().min(1),\n  radiusCardSm: z.string().min(1),\n  radiusButton: z.string().min(1),\n  radiusPill: z.string().min(1),\n  heroPadding: z.string().min(1),\n  sectionPadding: z.string().min(1),\n})\nexport type TailwindStyleTokens = z.infer<typeof TailwindStyleTokensSchema>\n\nexport const LandingContentSchema = z.object({\n  hero: z.object({\n    badge: z.string().min(1),\n    headline: z.string().min(1),\n    subheadline: z.string().min(1),\n  }),\n  stats: z\n    .object({\n      title: z.string().min(1),\n      items: z.array(z.object({ label: z.string().min(1), value: z.string().min(1) })).min(2).max(4),\n    })\n    .optional(),\n  features: z.object({\n    title: z.string().min(1),\n    items: z.array(\n      z.object({\n        title: z.string().min(1),\n        description: z.string().min(1),\n      })\n    ).min(3).max(6),\n  }),\n  testimonials: z\n    .object({\n      title: z.string().min(1),\n      items: z\n        .array(\n          z.object({\n            name: z.string().min(1),\n            role: z.string().min(1),\n            quote: z.string().min(1),\n          })\n        )\n        .min(2)\n        .max(4),\n    })\n    .optional(),\n  faq: z\n    .object({\n      title: z.string().min(1),\n      items: z.array(z.object({ q: z.string().min(1), a: z.string().min(1) })).min(3).max(6),\n    })\n    .optional(),\n  pricing: z.object({\n    title: z.string().min(1),\n    plans: z.array(\n      z.object({\n        name: z.string().min(1),\n        price: z.string().min(1),\n        description: z.string().min(1),\n        bullets: z.array(z.string().min(1)).min(3).max(8),\n        highlighted: z.boolean().default(false),\n      })\n    ).min(2).max(3),\n  }),\n  finalCta: z\n    .object({\n      title: z.string().min(1),\n      subtitle: z.string().min(1),\n    })\n    .optional(),\n  footer: z.object({\n    note: z.string().min(1),\n  }),\n})\nexport type LandingContent = z.infer<typeof LandingContentSchema>\n\nexport const SectionType = z.enum([\n  'hero',\n  'stats',\n  'features',\n  'pricing',\n  'testimonials',\n  'faq',\n  'lead',\n  'footer',\n])\nexport type SectionType = z.infer<typeof SectionType>\n\nexport const SiteLayoutSectionSchema = z.object({\n  type: SectionType,\n  variant: z.string().min(1).optional(),\n  anchor: z.string().min(1).optional(),\n})\nexport type SiteLayoutSection = z.infer<typeof SiteLayoutSectionSchema>\n\nexport const SiteLayoutSchema = z.object({\n  sections: z.array(SiteLayoutSectionSchema).min(3).max(12),\n})\nexport type SiteLayout = z.infer<typeof SiteLayoutSchema>\n\nexport const SiteConfigSchema = z.object({\n  version: z.literal(1),\n  styleKey: StyleKey,\n  tokens: TailwindStyleTokensSchema,\n  brief: SiteBriefSchema,\n  content: LandingContentSchema,\n  layout: SiteLayoutSchema.optional(),\n})\nexport type SiteConfig = z.infer<typeof SiteConfigSchema>\n\nexport function defaultLayoutForContent(content: LandingContent): SiteLayout {\n  const sections: SiteLayoutSection[] = [\n    { type: 'hero', variant: 'split', anchor: 'top' },\n  ]\n  if (content.stats) sections.push({ type: 'stats', variant: 'cards' })\n  sections.push({ type: 'features', variant: 'grid', anchor: 'features' })\n  sections.push({ type: 'pricing', variant: 'cards', anchor: 'pricing' })\n  if (content.testimonials) sections.push({ type: 'testimonials', variant: 'quotes' })\n  if (content.faq) sections.push({ type: 'faq', variant: 'accordion', anchor: 'faq' })\n  sections.push({ type: 'lead', variant: 'form', anchor: 'lead' })\n  sections.push({ type: 'footer', variant: 'simple' })\n  return { sections }\n}\n\nexport function tokensForStyle(styleKey: StyleKey): TailwindStyleTokens {\n  switch (styleKey) {\n    case 'minimalist_tech':\n      return {\n        fontHeading: 'var(--font-space)',\n        fontBody: 'var(--font-inter)',\n        bg: 'bg-gradient-to-b from-slate-950 via-slate-950 to-black',\n        card: 'bg-white/5 backdrop-blur border border-white/10 shadow-[0_20px_60px_rgba(0,0,0,0.35)]',\n        text: 'text-white',\n        muted: 'text-white/70',\n        border: 'border-white/10',\n        accent: 'bg-sky-400',\n        accentText: 'text-slate-950',\n        accentRing: 'ring-2 ring-sky-400/40',\n        radiusCard: 'rounded-3xl',\n        radiusCardSm: 'rounded-2xl',\n        radiusButton: 'rounded-xl',\n        radiusPill: 'rounded-full',\n        heroPadding: 'px-4 pt-14 pb-10',\n        sectionPadding: 'px-4 py-10',\n      }\n    case 'bold_modern':\n      return {\n        fontHeading: 'var(--font-syne)',\n        fontBody: 'var(--font-inter)',\n        bg: 'bg-gradient-to-b from-black via-zinc-950 to-slate-900',\n        card: 'bg-white/5 border border-white/10 shadow-[0_25px_70px_rgba(0,0,0,0.5)]',\n        text: 'text-white',\n        muted: 'text-white/70',\n        border: 'border-white/10',\n        accent: 'bg-fuchsia-500',\n        accentText: 'text-white',\n        accentRing: 'ring-2 ring-fuchsia-500/40',\n        radiusCard: 'rounded-[28px]',\n        radiusCardSm: 'rounded-2xl',\n        radiusButton: 'rounded-2xl',\n        radiusPill: 'rounded-full',\n        heroPadding: 'px-4 pt-16 pb-10',\n        sectionPadding: 'px-4 py-10',\n      }\n    case 'clean_corporate':\n      return {\n        fontHeading: 'var(--font-manrope)',\n        fontBody: 'var(--font-inter)',\n        bg: 'bg-gradient-to-b from-slate-50 to-white',\n        card: 'bg-white border border-slate-200 shadow-[0_8px_24px_rgba(15,23,42,0.08)]',\n        text: 'text-slate-900',\n        muted: 'text-slate-600',\n        border: 'border-slate-200',\n        accent: 'bg-blue-600',\n        accentText: 'text-white',\n        accentRing: 'ring-2 ring-blue-500/30',\n        radiusCard: 'rounded-3xl',\n        radiusCardSm: 'rounded-xl',\n        radiusButton: 'rounded-xl',\n        radiusPill: 'rounded-full',\n        heroPadding: 'px-4 pt-14 pb-10',\n        sectionPadding: 'px-4 py-10',\n      }\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEO,MAAM,WAAW,oLAAC,CAAC,IAAI,CAAC;IAAC;IAAmB;IAAe;CAAkB;AAG7E,MAAM,kBAAkB,oLAAC,CAAC,MAAM,CAAC;IACtC,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC7B,gBAAgB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC/B,UAAU,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,GAAG,CAAC;IACzC,qBAAqB,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,GAAG,CAAC;IACpD,KAAK,oLAAC,CACH,MAAM,CAAC;QACN,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,GACC,OAAO,CAAC;QAAE,OAAO;QAAkB,MAAM;IAAQ;IACpD,UAAU,oLAAC,CAAC,OAAO,CAAC,MAAM,OAAO,CAAC;AACpC;AAGO,MAAM,4BAA4B,oLAAC,CAAC,MAAM,CAAC;IAChD,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,IAAI,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACnB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACtB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC7B,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC7B,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,gBAAgB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AACjC;AAGO,MAAM,uBAAuB,oLAAC,CAAC,MAAM,CAAC;IAC3C,MAAM,oLAAC,CAAC,MAAM,CAAC;QACb,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACzB,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC9B;IACA,OAAO,oLAAC,CACL,MAAM,CAAC;QACN,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,OAAO,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,CAAC;YAAE,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YAAI,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAAG,IAAI,GAAG,CAAC,GAAG,GAAG,CAAC;IAC9F,GACC,QAAQ;IACX,UAAU,oLAAC,CAAC,MAAM,CAAC;QACjB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,OAAO,oLAAC,CAAC,KAAK,CACZ,oLAAC,CAAC,MAAM,CAAC;YACP,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YACtB,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC9B,IACA,GAAG,CAAC,GAAG,GAAG,CAAC;IACf;IACA,cAAc,oLAAC,CACZ,MAAM,CAAC;QACN,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,OAAO,oLAAC,CACL,KAAK,CACJ,oLAAC,CAAC,MAAM,CAAC;YACP,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YACrB,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YACrB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACxB,IAED,GAAG,CAAC,GACJ,GAAG,CAAC;IACT,GACC,QAAQ;IACX,KAAK,oLAAC,CACH,MAAM,CAAC;QACN,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,OAAO,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,CAAC;YAAE,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YAAI,GAAG,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAAG,IAAI,GAAG,CAAC,GAAG,GAAG,CAAC;IACtF,GACC,QAAQ;IACX,SAAS,oLAAC,CAAC,MAAM,CAAC;QAChB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,OAAO,oLAAC,CAAC,KAAK,CACZ,oLAAC,CAAC,MAAM,CAAC;YACP,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YACrB,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YACtB,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;YAC5B,SAAS,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,GAAG,CAAC,GAAG,GAAG,CAAC;YAC/C,aAAa,oLAAC,CAAC,OAAO,GAAG,OAAO,CAAC;QACnC,IACA,GAAG,CAAC,GAAG,GAAG,CAAC;IACf;IACA,UAAU,oLAAC,CACR,MAAM,CAAC;QACN,OAAO,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACtB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC3B,GACC,QAAQ;IACX,QAAQ,oLAAC,CAAC,MAAM,CAAC;QACf,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACvB;AACF;AAGO,MAAM,cAAc,oLAAC,CAAC,IAAI,CAAC;IAChC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,0BAA0B,oLAAC,CAAC,MAAM,CAAC;IAC9C,MAAM;IACN,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IACnC,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;AACpC;AAGO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,UAAU,oLAAC,CAAC,KAAK,CAAC,yBAAyB,GAAG,CAAC,GAAG,GAAG,CAAC;AACxD;AAGO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,SAAS,oLAAC,CAAC,OAAO,CAAC;IACnB,UAAU;IACV,QAAQ;IACR,OAAO;IACP,SAAS;IACT,QAAQ,iBAAiB,QAAQ;AACnC;AAGO,SAAS,wBAAwB,OAAuB;IAC7D,MAAM,WAAgC;QACpC;YAAE,MAAM;YAAQ,SAAS;YAAS,QAAQ;QAAM;KACjD;IACD,IAAI,QAAQ,KAAK,EAAE,SAAS,IAAI,CAAC;QAAE,MAAM;QAAS,SAAS;IAAQ;IACnE,SAAS,IAAI,CAAC;QAAE,MAAM;QAAY,SAAS;QAAQ,QAAQ;IAAW;IACtE,SAAS,IAAI,CAAC;QAAE,MAAM;QAAW,SAAS;QAAS,QAAQ;IAAU;IACrE,IAAI,QAAQ,YAAY,EAAE,SAAS,IAAI,CAAC;QAAE,MAAM;QAAgB,SAAS;IAAS;IAClF,IAAI,QAAQ,GAAG,EAAE,SAAS,IAAI,CAAC;QAAE,MAAM;QAAO,SAAS;QAAa,QAAQ;IAAM;IAClF,SAAS,IAAI,CAAC;QAAE,MAAM;QAAQ,SAAS;QAAQ,QAAQ;IAAO;IAC9D,SAAS,IAAI,CAAC;QAAE,MAAM;QAAU,SAAS;IAAS;IAClD,OAAO;QAAE;IAAS;AACpB;AAEO,SAAS,eAAe,QAAkB;IAC/C,OAAQ;QACN,KAAK;YACH,OAAO;gBACL,aAAa;gBACb,UAAU;gBACV,IAAI;gBACJ,MAAM;gBACN,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,YAAY;gBACZ,YAAY;gBACZ,YAAY;gBACZ,cAAc;gBACd,cAAc;gBACd,YAAY;gBACZ,aAAa;gBACb,gBAAgB;YAClB;QACF,KAAK;YACH,OAAO;gBACL,aAAa;gBACb,UAAU;gBACV,IAAI;gBACJ,MAAM;gBACN,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,YAAY;gBACZ,YAAY;gBACZ,YAAY;gBACZ,cAAc;gBACd,cAAc;gBACd,YAAY;gBACZ,aAAa;gBACb,gBAAgB;YAClB;QACF,KAAK;YACH,OAAO;gBACL,aAAa;gBACb,UAAU;gBACV,IAAI;gBACJ,MAAM;gBACN,MAAM;gBACN,OAAO;gBACP,QAAQ;gBACR,QAAQ;gBACR,YAAY;gBACZ,YAAY;gBACZ,YAAY;gBACZ,cAAc;gBACd,cAAc;gBACd,YAAY;gBACZ,aAAa;gBACb,gBAAgB;YAClB;IACJ;AACF"}},
    {"offset": {"line": 295, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/app/api/chat/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { GoogleGenerativeAI } from '@google/generative-ai'\nimport {\n  LandingContentSchema,\n  SiteBriefSchema,\n  StyleKey,\n  SiteConfigSchema,\n  SiteLayoutSchema,\n  defaultLayoutForContent,\n  tokensForStyle,\n} from '@/lib/siteConfig'\n\ntype ChatMessage = { role: 'system' | 'user' | 'assistant'; content: string }\n\ntype ChatState = {\n  step: 'collecting' | 'style' | 'generated'\n  brief?: unknown\n  styleKey?: string\n  siteId?: string\n}\n\ntype ChatRequest = {\n  messages: ChatMessage[]\n  state?: ChatState\n}\n\nfunction getEnv(name: string) {\n  return process.env[name]\n}\n\nconst STYLE_CHOICES = [\n  { key: 'minimalist_tech', label: 'Minimalist Tech', description: 'Қараңғы, минимал, glassy' },\n  { key: 'bold_modern', label: 'Bold Modern', description: 'Контраст, батыл accent' },\n  { key: 'clean_corporate', label: 'Clean Corporate', description: 'Ақ/жеңіл, корпоратив стиль' },\n] as const\n\nfunction buildFallbackContent(brief: any) {\n  return {\n    hero: {\n      badge: 'Vibe Coding • AI-first delivery',\n      headline: `${brief.businessName}: сатылым әкелетін лендинг және AI автоматизация`,\n      subheadline: `${brief.targetAudience} үшін: ${brief.services.join(', ')}. Нәтиже: ${brief.uniqueSellingPoints.slice(0, 2).join(' • ')}.`,\n    },\n    stats: {\n      title: 'Нәтиже',\n      items: [\n        { label: 'Дайындау уақыты', value: '1–3 күн' },\n        { label: 'Фокус', value: 'Конверсия' },\n        { label: 'Қолдау', value: 'Итерация + аналитика' },\n      ],\n    },\n    features: {\n      title: 'Не аласыз?',\n      items: [\n        { title: brief.services[0] || 'Лендинг', description: 'Конверсияға бағытталған құрылым, тез жүктелу, мобильді адаптив.' },\n        { title: brief.services[1] || 'AI автоматизация', description: 'Қолмен істейтін процестерді қысқартып, уақыт/шығын үнемдеу.' },\n        { title: brief.services[2] || 'Чат-бот/CRM', description: 'Лид жинау, квалификация, 24/7 байланыс және CRM интеграция.' },\n      ],\n    },\n    testimonials: {\n      title: 'Клиенттер не дейді?',\n      items: [\n        { name: 'Айгерім', role: 'Кәсіпкер', quote: 'Лендинг бірден түсінікті болды, лидтер көбейді.' },\n        { name: 'Дәурен', role: 'Сату менеджері', quote: 'CTA мен офферді дұрыстап берген соң конверсия өсті.' },\n      ],\n    },\n    faq: {\n      title: 'Жиі сұрақтар',\n      items: [\n        { q: 'Қанша уақытта дайын болады?', a: 'Бриф дайын болса, MVP 1–3 күн ішінде.' },\n        { q: 'Қандай интеграциялар бар?', a: 'WhatsApp/Telegram, CRM, analytics (GA/Pixel) қосамыз.' },\n        { q: 'Контентті өзгерте аламын ба?', a: 'Иә, конфиг арқылы тез өзгертіп шығамыз.' },\n      ],\n    },\n    pricing: {\n      title: 'Пакеттер',\n      plans: [\n        {\n          name: 'Start',\n          price: 'Бағасы келісім бойынша',\n          description: 'Жылдам MVP/лендинг',\n          bullets: ['1 бет лендинг', 'WhatsApp CTA', 'Базалық аналитика'],\n          highlighted: false,\n        },\n        {\n          name: 'Pro',\n          price: 'Бағасы келісім бойынша',\n          description: 'Автоматизация + интеграциялар',\n          bullets: ['Лендинг + бот/CRM', 'AI автоматизация сценарийі', 'Интеграциялар'],\n          highlighted: true,\n        },\n      ],\n    },\n    finalCta: {\n      title: 'Дайынсыз ба? 15 минутта бағыт береміз',\n      subtitle: 'Қысқа қоңырау → оффер → прототип. Бүгін бастайық.',\n    },\n    footer: {\n      note: `© ${brief.businessName}. Барлық құқық қорғалған.`,\n    },\n  }\n}\n\nfunction isModelNotFound(error: unknown) {\n  const message = String((error as any)?.message || error)\n  return (\n    message.includes('404') ||\n    message.toLowerCase().includes('not found') ||\n    message.toLowerCase().includes('not supported for generatecontent')\n  )\n}\n\nfunction buildMockResponse(state: ChatState, body: ChatRequest) {\n  const latestUser = body.messages[body.messages.length - 1]?.content || ''\n  const normalized = latestUser.toLowerCase()\n  const brief =\n    (state.brief as any) || {\n      businessName: latestUser.trim() ? latestUser.trim().slice(0, 60) : 'Demo бизнес',\n      targetAudience: 'Клиенттер',\n      services: ['Лендинг', 'AI автоматизация', 'Чат-бот/CRM'],\n      uniqueSellingPoints: ['Жылдам delivery', 'AI-first', 'Нақты нәтиже'],\n      cta: { label: 'Өтінім қалдыру', href: '#lead' },\n      language: 'KZ',\n    }\n\n  if (state.step === 'collecting') {\n    return {\n      terminal: true,\n      response: {\n        assistantMessage: 'Керемет! Енді стиль таңдаңыз.',\n        nextState: { step: 'style', brief },\n        briefComplete: true,\n        styles: STYLE_CHOICES,\n      },\n    }\n  }\n\n  if (state.step === 'style') {\n    const selected =\n      (['minimalist_tech', 'bold_modern', 'clean_corporate'] as const).find((key) => normalized.includes(key)) ||\n      undefined\n    if (!selected) {\n      return {\n        terminal: true,\n        response: {\n          assistantMessage: 'Қай стильді таңдайсыз? Төменнен таңдаңыз.',\n          nextState: { step: 'style', brief },\n          styles: STYLE_CHOICES,\n        },\n      }\n    }\n\n    return {\n      terminal: false,\n      response: {\n        assistantMessage: 'Жарайды! Генерация жасап жатырмын.',\n        nextState: { step: 'generated', brief, styleKey: selected },\n      },\n    }\n  }\n\n  return {\n    terminal: true,\n    response: {\n      assistantMessage: 'Кешіріңіз, түсінбедім. Қай стильді таңдайсыз?',\n      nextState: { step: 'style', brief },\n      styles: STYLE_CHOICES,\n    },\n  }\n}\n\nexport async function POST(req: Request) {\n  const useMock = process.env.MOCK_AI === 'true' || process.env.MOCK_AI === '1'\n  const apiKey = getEnv('GEMINI_API_KEY')\n  if (!useMock && !apiKey) {\n    return NextResponse.json(\n      { error: 'Missing GEMINI_API_KEY. Add it to .env.local (see .env.example).' },\n      { status: 400 }\n    )\n  }\n\n  let body: ChatRequest\n  try {\n    body = (await req.json()) as ChatRequest\n  } catch {\n    return NextResponse.json({ error: 'Invalid JSON body' }, { status: 400 })\n  }\n\n  const state: ChatState = body?.state ?? { step: 'collecting' }\n  if (!Array.isArray(body?.messages)) {\n    return NextResponse.json({ error: 'Invalid request: messages must be an array' }, { status: 400 })\n  }\n\n  const mockResult = buildMockResponse(state, body)\n\n  if (useMock) {\n    if (mockResult.terminal) return NextResponse.json(mockResult.response)\n  }\n\n  let parsed: any | null = null\n  const genAI = new GoogleGenerativeAI(apiKey as string)\n  const modelName = (() => {\n    const raw = process.env.GEMINI_MODEL?.trim()\n    if (!raw) return 'gemini-1.5-flash'\n    if (raw === 'gemini-1.5-flash-latest') return 'gemini-1.5-flash'\n    if (raw === 'gemini-1.5-pro-latest') return 'gemini-1.5-pro'\n    return raw\n  })()\n  const modelFallbacks = [\n    modelName,\n    'gemini-1.5-flash',\n    'gemini-1.5-pro',\n    'gemini-1.5-flash-8b',\n    'gemini-1.0-pro',\n    'gemini-pro',\n  ].filter(Boolean)\n\n  async function generateWithFallback(options: { instruction: string; temperature: number }) {\n    let lastError: unknown = null\n    for (const name of modelFallbacks) {\n      try {\n        const model = genAI.getGenerativeModel({\n          model: name,\n          generationConfig: {\n            temperature: options.temperature,\n            responseMimeType: 'application/json',\n          },\n        })\n        const result = await model.generateContent(options.instruction)\n        return { text: result.response.text(), model: name }\n      } catch (e) {\n        lastError = e\n        if (!isModelNotFound(e)) {\n          throw e\n        }\n      }\n    }\n    throw lastError\n  }\n\n  const system: ChatMessage = {\n    role: 'system',\n    content:\n      'You are an AI product assistant for generating a landing page. ' +\n      'You must ask strategic questions to collect: business name, target audience, services (list), unique selling points (list), and CTA (label + link). ' +\n      'Once the brief is complete, offer 3 styles: Minimalist Tech, Bold Modern, Clean Corporate. ' +\n      'Always respond in Kazakh (KZ). Keep questions short. '\n  }\n\n  const styleOptions =\n    'Styles:\\n' +\n    '- minimalist_tech: Minimalist Tech (dark, glassy, tech)\\n' +\n    '- bold_modern: Bold Modern (high-contrast, loud accent)\\n' +\n    '- clean_corporate: Clean Corporate (light, calm, business)'\n\n  const schemaInstruction =\n    'Return a JSON object with shape:\\n' +\n    '{\"assistantMessage\": string, \"nextState\": {\"step\": \"collecting\"|\"style\"|\"generated\", \"brief\"?: object, \"styleKey\"?: string, \"siteId\"?: string}, \"briefComplete\"?: boolean, \"styles\"?: array}\\n' +\n    'Rules:\\n' +\n    '- If step=collecting: ask the next missing info; when complete set briefComplete=true and nextState.step=\"style\" and include styles list.\\n' +\n    '- If step=style: user will choose styleKey; then set nextState.step=\"generated\" and return nextState.styleKey.\\n'\n\n  const prompt: ChatMessage[] = [\n    system,\n    { role: 'system', content: `Current step: ${state.step}. Current brief: ${JSON.stringify(state.brief ?? {})}` },\n    { role: 'system', content: styleOptions },\n    { role: 'system', content: schemaInstruction },\n    ...body.messages,\n  ]\n\n  if (!useMock) {\n    let rawText = ''\n    try {\n      // Convert ChatMessage[] to a single instruction (simple + robust for v1)\n      const transcript = prompt\n        .filter((m) => m.role !== 'system')\n        .map((m) => `${m.role.toUpperCase()}: ${m.content}`)\n        .join('\\n')\n\n      const instruction =\n        `${system.content}\\n\\n` +\n        `${styleOptions}\\n\\n` +\n        `${schemaInstruction}\\n\\n` +\n        `Conversation:\\n${transcript}\\n\\n` +\n        `Now output ONLY the JSON object described above.`\n\n      const result = await generateWithFallback({ instruction, temperature: 0.4 })\n      rawText = result.text\n    } catch (e) {\n      if (isModelNotFound(e)) {\n        if (mockResult.terminal) return NextResponse.json(mockResult.response)\n        parsed = mockResult.response\n      } else {\n        return NextResponse.json(\n          { error: 'Gemini request failed', details: String((e as any)?.message || e) },\n          { status: 500 }\n        )\n      }\n    }\n\n    if (!parsed) {\n      const raw = rawText || '{}'\n      try {\n        parsed = JSON.parse(raw)\n      } catch {\n        return NextResponse.json({ error: 'Bad JSON from model', raw }, { status: 500 })\n      }\n    }\n  } else {\n    parsed = mockResult.response\n  }\n\n  // Validate/normalize brief if present\n  if (parsed?.nextState?.brief) {\n    const briefResult = SiteBriefSchema.safeParse(parsed.nextState.brief)\n    if (briefResult.success) parsed.nextState.brief = briefResult.data\n  }\n\n  // If we reached generated with valid brief + styleKey, create SiteConfig and persist\n  const maybeStyle = parsed?.nextState?.styleKey\n  const maybeBrief = parsed?.nextState?.brief\n\n  if (parsed?.nextState?.step === 'generated' && maybeStyle && maybeBrief) {\n    const styleKeyResult = StyleKey.safeParse(maybeStyle)\n    const briefResult = SiteBriefSchema.safeParse(maybeBrief)\n\n    if (styleKeyResult.success && briefResult.success) {\n      const styleKey = styleKeyResult.data\n      const brief = briefResult.data\n\n      let content: any = buildFallbackContent(brief)\n      let layout = defaultLayoutForContent(content)\n      if (!useMock) {\n        try {\n          const contentPrompt =\n            'Generate landing page content in Kazakh (KZ). ' +\n            'Return JSON with shape: { ' +\n            '\"hero\": { \"badge\": string, \"headline\": string, \"subheadline\": string }, ' +\n            '\"stats\"?: { \"title\": string, \"items\": [{ \"label\": string, \"value\": string }] }, ' +\n            '\"features\": { \"title\": string, \"items\": [{ \"title\": string, \"description\": string }] }, ' +\n            '\"testimonials\"?: { \"title\": string, \"items\": [{ \"name\": string, \"role\": string, \"quote\": string }] }, ' +\n            '\"faq\"?: { \"title\": string, \"items\": [{ \"q\": string, \"a\": string }] }, ' +\n            '\"pricing\": { \"title\": string, \"plans\": [{ \"name\": string, \"price\": string, \"description\": string, \"bullets\": [string], \"highlighted\": boolean }] }, ' +\n            '\"finalCta\"?: { \"title\": string, \"subtitle\": string }, ' +\n            '\"footer\": { \"note\": string } }.\\n\\n' +\n            `Brief: ${JSON.stringify(brief)}\\n` +\n            `Style: ${styleKey}\\n` +\n            'Constraints: stats.items 2-4; features.items 3-6; testimonials.items 2-4; faq.items 3-6; pricing.plans 2-3; bullets 3-6; keep it concise.\\n' +\n            'Output JSON only.'\n\n          const contentRes = await generateWithFallback({ instruction: contentPrompt, temperature: 0.6 })\n          const contentRaw = contentRes.text || '{}'\n          const contentJson = JSON.parse(contentRaw)\n          const contentParsed = LandingContentSchema.safeParse(contentJson)\n          if (contentParsed.success) {\n            content = contentParsed.data\n            layout = defaultLayoutForContent(content)\n          }\n        } catch {\n          // Keep fallbackContent if Gemini content generation fails\n        }\n      }\n\n      // Ask Gemini to design the layout (order + variants) using already-generated content keys\n      if (!useMock) {\n        try {\n          const layoutPrompt =\n            'You are a senior landing-page designer. Create a section layout plan for a landing page in Kazakh.\\n' +\n            'Return JSON ONLY with shape: { \"sections\": [{ \"type\": \"hero\"|\"stats\"|\"features\"|\"pricing\"|\"testimonials\"|\"faq\"|\"lead\"|\"footer\", \"variant\"?: string, \"anchor\"?: string }] }.\\n' +\n            'Rules:\\n' +\n            '- Use only the section types listed above.\\n' +\n            '- Include hero first and footer last.\\n' +\n            '- Use anchors for features/pricing/faq/lead when present.\\n' +\n            '- If content.stats/testimonials/faq is missing, do not include those sections.\\n' +\n            '- Choose variants to match styleKey (minimalist_tech/bold_modern/clean_corporate). Examples: hero: split|centered|minimal; features: grid|zigzag; pricing: cards|table; faq: accordion|cards.\\n' +\n            `styleKey: ${styleKey}\\n` +\n            `brief: ${JSON.stringify(brief)}\\n` +\n            `contentKeys: ${JSON.stringify({\n              hasStats: Boolean(content?.stats),\n              hasTestimonials: Boolean(content?.testimonials),\n              hasFaq: Boolean(content?.faq),\n            })}\\n` +\n            'Output JSON only.'\n\n          const layoutRes = await generateWithFallback({ instruction: layoutPrompt, temperature: 0.2 })\n          const layoutJson = JSON.parse(layoutRes.text || '{}')\n          const layoutParsed = SiteLayoutSchema.safeParse(layoutJson)\n          if (layoutParsed.success) {\n            layout = layoutParsed.data\n          }\n        } catch {\n          // keep default layout\n        }\n      }\n\n      const config = {\n        version: 1 as const,\n        styleKey,\n        tokens: tokensForStyle(styleKey),\n        brief,\n        content,\n        layout,\n      }\n\n      const validated = SiteConfigSchema.safeParse(config)\n      if (!validated.success) {\n        return NextResponse.json({ error: 'Generated config failed validation', issues: validated.error.issues }, { status: 500 })\n      }\n\n      const { supabaseServer } = await import('@/lib/supabase')\n      let supabase: ReturnType<typeof supabaseServer> | null = null\n      try {\n        supabase = supabaseServer()\n      } catch {\n        supabase = null\n      }\n\n      if (supabase) {\n        const insertRes = await supabase\n          .from('sites')\n          .insert({\n            brief: brief,\n            config: validated.data,\n            style_key: styleKey,\n          })\n          .select('id')\n          .single()\n\n        if (insertRes.error) {\n          return NextResponse.json({ error: 'Supabase insert failed', details: insertRes.error.message }, { status: 500 })\n        }\n\n        parsed.nextState.siteId = insertRes.data.id\n        parsed.siteUrl = `/site/${insertRes.data.id}`\n      } else {\n        const { saveMockSite } = await import('@/lib/mockStore')\n        const mockId = await saveMockSite(validated.data)\n        parsed.nextState.siteId = mockId\n        parsed.siteUrl = `/site/${mockId}`\n      }\n    }\n  }\n\n  return NextResponse.json(parsed)\n}\n"],"names":[],"mappings":"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"}}]
}