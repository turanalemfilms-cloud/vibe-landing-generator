{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nexport function supabaseBrowser() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n  if (!url || !anon) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / NEXT_PUBLIC_SUPABASE_ANON_KEY')\n  return createClient(url, anon)\n}\n\nexport function supabaseServer() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const service = process.env.SUPABASE_SERVICE_ROLE_KEY\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!url) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL')\n\n  // Prefer service role for server-side writes. Fallback to anon for quick demo.\n  const key = service || anon\n  if (!key) throw new Error('Missing SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY')\n\n  return createClient(url, key, {\n    auth: { persistSession: false },\n  })\n}\n\nexport function supabaseService() {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const service = process.env.SUPABASE_SERVICE_ROLE_KEY\n  if (!url || !service) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / SUPABASE_SERVICE_ROLE_KEY')\n  return createClient(url, service, { auth: { persistSession: false } })\n}\n\nexport function supabaseServerWithAccessToken(accessToken: string) {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n  if (!url || !anon) throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL / NEXT_PUBLIC_SUPABASE_ANON_KEY')\n  if (!accessToken) throw new Error('Missing access token')\n\n  // Use anon key + user JWT so RLS applies server-side.\n  return createClient(url, anon, {\n    auth: { persistSession: false },\n    global: {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,SAAS;IACd,MAAM;IACN,MAAM;IACN;;IACA,OAAO,IAAA,gMAAY,EAAC,KAAK;AAC3B;AAEO,SAAS;IACd,MAAM;IACN,MAAM,UAAU,QAAQ,GAAG,CAAC,yBAAyB;IACrD,MAAM;IAEN;;IAEA,+EAA+E;IAC/E,MAAM,MAAM,WAAW;IACvB;;IAEA,OAAO,IAAA,gMAAY,EAAC,KAAK,KAAK;QAC5B,MAAM;YAAE,gBAAgB;QAAM;IAChC;AACF;AAEO,SAAS;IACd,MAAM;IACN,MAAM,UAAU,QAAQ,GAAG,CAAC,yBAAyB;IACrD,IAAI,CAAC,OAAO,CAAC,SAAS,MAAM,IAAI,MAAM;IACtC,OAAO,IAAA,gMAAY,EAAC,KAAK,SAAS;QAAE,MAAM;YAAE,gBAAgB;QAAM;IAAE;AACtE;AAEO,SAAS,8BAA8B,WAAmB;IAC/D,MAAM;IACN,MAAM;IACN;;IACA,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;IAElC,sDAAsD;IACtD,OAAO,IAAA,gMAAY,EAAC,KAAK,MAAM;QAC7B,MAAM;YAAE,gBAAgB;QAAM;QAC9B,QAAQ;YACN,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,aAAa;YACxC;QACF;IACF;AACF"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/gulzhanserikbay/vibe-landing-generator/src/app/api/debug/latest-site/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { supabaseServer } from '@/lib/supabase'\n\nexport const runtime = 'nodejs'\n\nexport async function GET() {\n  if (process.env.NODE_ENV === 'production') {\n    return NextResponse.json({ error: 'Not found' }, { status: 404 })\n  }\n\n  let supabase: ReturnType<typeof supabaseServer>\n  try {\n    supabase = supabaseServer()\n  } catch (e) {\n    return NextResponse.json(\n      { error: 'Supabase env is missing', details: String((e as any)?.message || e) },\n      { status: 400 }\n    )\n  }\n\n  const { data, error } = await supabase\n    .from('sites')\n    .select('id, created_at, config')\n    .order('created_at', { ascending: false })\n    .limit(1)\n    .maybeSingle()\n\n  if (error) {\n    return NextResponse.json(\n      {\n        error: 'Query failed',\n        details: error?.message,\n        hint: 'If you recently created the table, wait ~30s or restart dev server (schema cache). Also ensure env points to the same project you linked via supabase CLI.',\n        env: {\n          url: process.env.NEXT_PUBLIC_SUPABASE_URL || null,\n          hasAnon: Boolean(process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY),\n          hasServiceRole: Boolean(process.env.SUPABASE_SERVICE_ROLE_KEY),\n        },\n      },\n      { status: 500 }\n    )\n  }\n\n  if (!data) {\n    return NextResponse.json({\n      id: null,\n      created_at: null,\n      layout: null,\n      note: 'No rows in public.sites yet. Generate a new site from the homepage chat, then refresh this endpoint.',\n    })\n  }\n\n  return NextResponse.json({\n    id: data.id,\n    created_at: data.created_at,\n    layout: (data as any).config?.layout || null,\n  })\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe;IACpB;;IAIA,IAAI;IACJ,IAAI;QACF,WAAW,IAAA,0IAAc;IAC3B,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAA2B,SAAS,OAAO,AAAC,GAAW,WAAW;QAAG,GAC9E;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC,0BACP,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM,GACvC,KAAK,CAAC,GACN,WAAW;IAEd,IAAI,OAAO;QACT,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,OAAO;YAChB,MAAM;YACN,KAAK;gBACH,KAAK,gFAAwC;gBAC7C,SAAS;gBACT,gBAAgB,QAAQ,QAAQ,GAAG,CAAC,yBAAyB;YAC/D;QACF,GACA;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,YAAY;YACZ,QAAQ;YACR,MAAM;QACR;IACF;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,IAAI,KAAK,EAAE;QACX,YAAY,KAAK,UAAU;QAC3B,QAAQ,AAAC,KAAa,MAAM,EAAE,UAAU;IAC1C;AACF"}}]
}